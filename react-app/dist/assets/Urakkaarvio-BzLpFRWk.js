import{u as P,a as z,r as l,P as x,j as t,L as C,H as N}from"./index-MnKNPAzJ.js";function W(){var T;const $=P(),S=z(),M=l.useMemo(()=>Object.entries(x).map(([e,a])=>({key:e,...a})),[]),[d,A]=l.useState(((T=M[0])==null?void 0:T.key)||""),[c,u]=l.useState([]),[L,V]=l.useState(""),[E,v]=l.useState(!1),[I,j]=l.useState(!1),[m,g]=l.useState(!1),[R,b]=l.useState({}),h=.255,f="urakkaEstimate.v1";l.useEffect(()=>{try{const a=new URLSearchParams(S.search).get("est");if(a)try{const n=decodeURIComponent(atob(a)),i=JSON.parse(n);if(i&&Array.isArray(i.i)){const r=i.i.map(o=>{const p=x[o.k];return p?{key:o.k,label:p.label,unit:p.unit,min:p.min,max:p.max,qty:Math.max(0,Number(o.q)||0)}:null}).filter(Boolean);r.length&&u(r)}i&&typeof i.vt<"u"&&g(!!i.vt)}catch{}const s=localStorage.getItem(f);if(!a&&s){const n=JSON.parse(s);if(Array.isArray(n.items)){const i=n.items.map(r=>{const o=x[r.key];return o?{key:r.key,label:o.label,unit:o.unit,min:o.min,max:o.max,qty:Math.max(0,Number(r.qty)||0)}:null}).filter(Boolean);i.length&&u(i)}n.selectedKey&&x[n.selectedKey]&&A(n.selectedKey),typeof n.includeVat=="boolean"&&g(!!n.includeVat)}}catch{}},[S.search]),l.useEffect(()=>{try{const e={selectedKey:d,includeVat:m,items:c.map(a=>({key:a.key,qty:a.qty}))};localStorage.setItem(f,JSON.stringify(e))}catch{}},[c,d,m]);const U=()=>{if(!d||c.some(a=>a.key===d))return;const e=x[d];u(a=>[...a,{key:d,label:e.label,unit:e.unit,min:e.min,max:e.max,qty:0}])},w=(e,a)=>{b(r=>({...r,[e]:a}));const s=(a??"").toString().replace(",","."),n=Number(s),i=isNaN(n)?0:Math.max(0,n);u(r=>r.map(o=>o.key===e?{...o,qty:i}:o))},B=(e,a)=>{b(s=>({...s,[e]:a===0?"":String(a)}))},K=e=>{b(a=>{const{[e]:s,...n}=a;return n})},O=e=>u(a=>a.filter(s=>s.key!==e)),Y=()=>{u([]);try{localStorage.removeItem(f)}catch{}},D=()=>{var e;try{const a=`${window.location.origin}/`,s={v:1,vt:m?1:0,i:c.map(r=>({k:r.key,q:r.qty}))},n=btoa(encodeURIComponent(JSON.stringify(s))),i=`${a.replace(/\/$/,"/")}urakka-arvio?est=${n}`;return V(i),(e=navigator.clipboard)==null||e.writeText(i).then(()=>v(!0)).catch(()=>v(!1)),i}catch{return V(""),v(!1),""}},y=c.reduce((e,a)=>({min:e.min+a.qty*a.min,max:e.max+a.qty*a.max}),{min:0,max:0}),k={min:Math.round(y.min*(1+h)),max:Math.round(y.max*(1+h))},q=()=>{if(!c.length)return`Urakka-arvion luonnos: (ei rivej√§)
`;const e=[];e.push("Urakka-arvion luonnos (ty√∂, ALV 0 %):");for(const a of c){const s=Math.round(a.qty*a.min),n=Math.round(a.qty*a.max);e.push(`- ${a.label}: ${a.qty} ${a.unit} √ó ${a.min}‚Äì${a.max} ‚Ç¨/ ${a.unit} ‚Üí ~${s}‚Äì${n} ‚Ç¨`)}return e.push(`Yhteens√§: ~${Math.round(y.min)}‚Äì${Math.round(y.max)} ‚Ç¨ (ty√∂, ALV 0 %)`),m&&e.push(`Verollinen yhteens√§ (ALV 25,5 %): ~${k.min}‚Äì${k.max} ‚Ç¨`),e.push("Huom: Arvio on karkea. Materiaalit, suojaukset ja telineet erikseen."),e.join(`
`)},F=()=>{const e=q();try{sessionStorage.setItem("estimateDraft",e)}catch{}$("/#contact")},J=async()=>{var e;try{const a=q();await((e=navigator.clipboard)==null?void 0:e.writeText(a)),j(!0),setTimeout(()=>j(!1),2e3)}catch{j(!1)}};return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"container",children:t.jsxs("nav",{className:"breadcrumbs",children:[t.jsx(C,{to:"/",children:"Etusivu"}),t.jsx("span",{className:"sep",children:"‚Ä∫"}),t.jsx("span",{className:"current",children:"Urakka-arvio"})]})}),t.jsx("section",{className:"services",children:t.jsxs("div",{className:"container",children:[t.jsx("h1",{className:"section-title",children:"Urakka-arvio (ALV 0 %)"}),t.jsx("p",{className:"section-description",children:"Valitse alla ty√∂vaiheita, sy√∂t√§ m√§√§r√§t ja laske karkea urakka-arvio ty√∂n osuudelle ilman ALV:ia. Materiaalit, suojaukset ja mahdolliset telineet erikseen. Arviot ovat eritt√§in suuntaa antavia."}),t.jsxs("div",{className:"contact-form",style:{marginBottom:"2rem"},children:[t.jsxs("div",{className:"form-group",children:[t.jsx("label",{htmlFor:"cat",children:"Lis√§√§ ty√∂vaihe"}),t.jsx("select",{id:"cat",value:d,onChange:e=>A(e.target.value),style:{width:"100%",padding:15,border:"2px solid #e0e0e0",borderRadius:10,fontSize:"1rem"},children:M.map(e=>t.jsxs("option",{value:e.key,children:[e.label," (",e.unit,")"]},e.key))})]}),t.jsx("button",{type:"button",className:"submit-btn",onClick:U,children:"Lis√§√§ listaan"}),t.jsxs("div",{className:"form-group",style:{marginTop:12},children:[t.jsx("label",{htmlFor:"vatMode",children:"ALV-n√§ytt√∂"}),t.jsxs("select",{id:"vatMode",value:m?"1":"0",onChange:e=>g(e.target.value==="1"),style:{width:"100%",padding:12,border:"2px solid #e0e0e0",borderRadius:10},children:[t.jsx("option",{value:"0",children:"ALV 0 % (n√§yt√§ verottomat hinnat)"}),t.jsx("option",{value:"1",children:"ALV 25,5 % (n√§yt√§ verolliset hinnat)"})]})]})]}),c.length>0&&t.jsx("div",{className:"services-grid",style:{marginTop:"1rem"},children:c.map(e=>{const a=Math.round(e.qty*e.min),s=Math.round(e.qty*e.max);return t.jsxs("div",{className:"service-card",children:[t.jsx("div",{className:"service-icon",children:"üßÆ"}),t.jsx("h3",{style:{marginBottom:8},children:e.label}),t.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center",justifyContent:"center",marginBottom:8},children:[t.jsx("input",{type:"number",min:"0",step:"any",value:R[e.key]??(e.qty===0?"":String(e.qty)),onFocus:()=>B(e.key,e.qty),onBlur:()=>K(e.key),onChange:n=>w(e.key,n.target.value),style:{width:120,padding:10,border:"2px solid #e0e0e0",borderRadius:10},"aria-label":"M√§√§r√§"}),t.jsx("span",{style:{color:"#6b7280"},children:e.unit})]}),t.jsxs("p",{style:{marginBottom:4},children:["Yksikk√∂hinta: ",e.min,"‚Äì",e.max," ‚Ç¨/ ",e.unit]}),m&&t.jsxs("p",{style:{marginBottom:8,color:"#374151"},children:["Yksikk√∂hinta verollisena: ",Math.round(e.min*(1+h)),"‚Äì",Math.round(e.max*(1+h))," ‚Ç¨/ ",e.unit]}),t.jsxs("p",{style:{fontWeight:700},children:["Arvio t√§lle: ~",a,"‚Äì",s," ‚Ç¨"]}),m&&t.jsxs("p",{style:{fontWeight:600,color:"#374151"},children:["Verollinen: ~",Math.round(a*(1+h)),"‚Äì",Math.round(s*(1+h))," ‚Ç¨"]}),t.jsx("div",{style:{marginTop:8},children:t.jsx("button",{type:"button",className:"cb-btn ghost",onClick:()=>O(e.key),children:"Poista"})})]},e.key)})}),t.jsxs("div",{className:"service-card",style:{marginTop:"1.5rem"},children:[t.jsx("div",{className:"service-icon",children:"Œ£"}),t.jsx("h3",{children:"Kokonaisarvio (ty√∂, ALV 0 %)"}),t.jsxs("p",{style:{fontSize:"1.1rem"},children:["Yhteens√§: ",t.jsxs("strong",{children:["~",Math.round(y.min),"‚Äì",Math.round(y.max)," ‚Ç¨"]})]}),m&&t.jsxs("p",{style:{fontSize:"1.05rem",fontWeight:700},children:["Verollinen yhteens√§ (ALV 25,5 %): ~",k.min,"‚Äì",k.max," ‚Ç¨"]}),t.jsxs("p",{className:"cb-muted",children:["Tuntiveloitus tyypillisesti ",N.min,"‚Äì",N.max," ‚Ç¨/h (",N.note,")."]}),t.jsxs("div",{style:{marginTop:8},children:[t.jsx("button",{type:"button",className:"cb-btn ghost",onClick:Y,children:"Tyhjenn√§ arvio"}),t.jsx("button",{type:"button",className:"cb-btn",style:{marginLeft:8},onClick:D,children:"Jaa linkki"}),t.jsx("button",{type:"button",className:"cb-btn",style:{marginLeft:8},onClick:J,children:"Kopioi erittely"})]}),L&&t.jsxs("div",{className:"cb-muted",style:{marginTop:8,wordBreak:"break-all"},children:[E?"Linkki kopioitu leikep√∂yd√§lle.":"Kopioi ja jaa t√§m√§ linkki:",t.jsx("div",{style:{marginTop:6,fontSize:"0.85rem"},children:L})]}),I&&t.jsx("div",{className:"cb-muted",style:{marginTop:8},children:"Erittely kopioitu leikep√∂yd√§lle."})]}),t.jsxs("div",{style:{textAlign:"center",marginTop:"2rem",display:"flex",gap:"12px",justifyContent:"center",flexWrap:"wrap"},children:[t.jsx("button",{type:"button",className:"cta-button",onClick:F,children:"L√§het√§ viesti"}),t.jsx(C,{className:"cta-button",to:"/#contact",children:"Pelkk√§ yhteydenotto"})]}),t.jsx("p",{style:{marginTop:"2rem",color:"#6b7280",textAlign:"center"},children:"Huom: Arviot koskevat ty√∂n osuutta ilman ALV:ia. Materiaalit, suojaukset ja telineet erikseen. Lopullinen hinta tarkentuu katselmuksessa."})]})})]})}export{W as default};
